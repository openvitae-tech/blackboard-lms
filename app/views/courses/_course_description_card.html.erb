<div class="flex flex-col border border-line-colour rounded-xl">
  <div class="flex flex-col md:flex-row relative">
    <div class="absolute top-0 left-0 z-10 flex flex-wrap justify-start gap-2 heading">
      <% course.tags.each do |tag| %>
        <% if tag.tag_type == "level" %>
          <span class="px-2 py-1 text-xs font-medium bg-secondary text-primary-dark rounded-tl-xl rounded-br-xl">
            <%= tag.name %>
          </span>
        <% end %>
      <% end %>
    </div>
    <div class="relative">
      <%= image_tag course_banner(course, :vertical), class: "h-[140px] w-full md:w-[240px] md:h-[260px] object-cover rounded-t-xl md:rounded-tr-none md:rounded-l-xl" %>
      <span class="absolute bottom-0 right-4 z-10 flex rounded-t-md bg-primary-light-100 general-text-sm-normal py-0.5 px-1 text-primary-dark">
          <%= course_duration(course) %>
       </span>
    </div>  
    <% if current_user.is_admin? %>
      <div class="absolute top-3 md:top-4 right-3 md:right-4 flex">
      <%= menu_component(menu_items: course_menu_items(course)) %>      
      </div> 
    <% end %>
    <div class="flex w-full flex-col gap-3 p-5">
      <div class="flex justify-between">
        <p class="overflow-hidden text-ellipsis text-letter-color main-text-lg-medium">
          <%= course.title %>
        </p>
      </div>
      <% if local_assigns[:enrollment].present? %>
        <div class="w-full md:w-80">
          <%= render "shared/components/progress_bar", progress: enrollment.progress %>
        </div>
        <% if enrollment.deadline_present? %>
          <div class="text-sm">
            <%= pluralize(days_remaining(enrollment.deadline_at), "day") %> left
          </div>
        <% end %>
      <% end %>
      <div class="flex gap-3 md:gap-4">
        <% if course.rating.present? %>
        <div class="flex items-center">
          <%= icon("star-transparent", css: "h-4 w-4 text-primary fill-primary") %>
          <span class="ml-2 general-text-sm-normal"><%= course.rating %></span>
        </div>
        <div class="w-px h-full bg-slate-grey-light md:hidden"></div>
        <% end %>
        <div class="flex items-center">
          <%= icon("book", css: "h-4 w-4 text-primary") %>
          <span class="ml-2 general-text-sm-normal font-medium"><%= pluralize(modules_count(course), 'module') %></span>
        </div>
        <div class="w-px h-full bg-slate-grey-light"></div>
        <%= render 'shared/components/tooltip', tooltip_text: pluralize(enroll_count(course), t("course.enroll.user")) do %>
          <div class="flex items-center">
            <%= icon("user", css: "h-4 w-4 text-primary") %>
            <span class="ml-2 general-text-sm-normal font-medium"><%= enroll_count(course) %></span>
          </div>
        <% end %>
      </div>
      <div class="p-4 text-justify tracking-tight bg-primary-light-50 rounded-lg max-h-[116px]">
        <div class="h-full overflow-hidden flex items-center main-text-sm-normal">
          <%= course_description(course) %>
        </div>
      </div>
      <div class="flex flex-col md:flex-row justify-between gap-6">
        <div class="flex flex-wrap gap-2 h-[24px]">
          <% course.tags.each do |tag| %>
            <% if tag.tag_type == "category" %>
              <%= chip_component(text: tag.name , colorscheme: 'primary', icon_name: 'check') %>
            <% end %>
          <% end %>
        </div>
        <div class="flex flex-wrap justify-center md:justify-end  gap-4">
          <% if policy(course).unenroll? %>
            <%= link_to unenroll_course_path(course), data: { turbo_method: :put, turbo_confirm: t("course.drop_warning") } do %>
              <%= button(label: "Drop", type: "secondary", icon_name: "minus") %>
            <% end %>
          <% end %>
          <% if policy(course).enroll? %>
            <%= link_to enroll_course_path(course), data: { turbo_method: :put }  do %>
              <%= button(label: I18n.t('course.enroll.label')) %>
            <% end %>
          <% end %>
          <% if policy(course).proceed? %>
            <%= link_to proceed_course_path(course) do %>
              <%= button(label: "Continue", icon_name: "chevron-double-right", icon_position: "right") %>
            <% end %>
          <% end %>
        </div>
      </div>  
    </div>
  </div>
</div>
